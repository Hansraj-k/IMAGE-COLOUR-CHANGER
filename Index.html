<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove Specific Color from Image</title>
    <style>
        #canvas {
            max-width: 100%; /* Set max size for canvas */
            max-height: 500.1px; /* Set max size for canvas */
            border: 1px solid black;
            cursor: crosshair; /* Cursor for selecting color */
        }
        #selectedColor {
            width: 50px;
            height: 50px;
            border-radius: 50%; /* Make the div a circle */
            border: 1px solid #000;
            display: inline-block;
            margin: 10px 0;
        }
        .color-inputs {
            margin: 10px 0;
        }
        #imageDimensions {
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <input type="file" id="upload" accept="image/*">
    <button id="eyeDropperBtn">ðŸ–¤ Pick Color</button>
    <div class="color-inputs">
        <label for="hexInput">Hex Code:</label>
        <input type="text" id="hexInput" value="#ffffff">
    </div>
    <div class="color-inputs">
        <label for="rgbInput">RGB:</label>
        <input type="text" id="rgbInput" value="rgb(255, 255, 255)">
    </div>
    <div id="selectedColor" style="background-color: #ffffff;"></div>
    <div id="imageDimensions">Dimensions: Not uploaded yet</div>
    <button onclick="removeColor()">Remove Color</button>
    <button onclick="downloadImage()">Download Image</button>
    <canvas id="canvas"></canvas>
    <script>
        const upload = document.getElementById('upload');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const eyeDropperBtn = document.getElementById('eyeDropperBtn');
        const hexInput = document.getElementById('hexInput');
        const rgbInput = document.getElementById('rgbInput');
        const selectedColorDiv = document.getElementById('selectedColor');
        const imageDimensions = document.getElementById('imageDimensions');
        
        let img = new Image();
        let selectedColor = '#ffffff';
        let originalImgData;
        let originalImageSrc;
        let originalImageName = "image"; // Default name for the image

        upload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                originalImageName = file.name.split('.')[0]; // Extract name without extension
                const reader = new FileReader();
                reader.onload = (e) => {
                    img.src = e.target.result;
                    originalImageSrc = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        img.onload = () => {
            // Display image dimensions
            const width = img.width;
            const height = img.height;
            imageDimensions.textContent = `Dimensions: ${width}px x ${height}px`;

            // Store original image data in full quality
            originalImgData = getImageDataForOriginal(img);

            const maxSize = 500;
            let widthAdjusted = img.width;
            let heightAdjusted = img.height;
            if (widthAdjusted > maxSize || heightAdjusted > maxSize) {
                const ratio = Math.min(maxSize / widthAdjusted, maxSize / heightAdjusted);
                widthAdjusted = widthAdjusted * ratio;
                heightAdjusted = heightAdjusted * ratio;
            }

            canvas.width = widthAdjusted;
            canvas.height = heightAdjusted;
            ctx.drawImage(img, 0, 0, widthAdjusted, heightAdjusted);
        };

        function getImageDataForOriginal(image) {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = image.width;
            tempCanvas.height = image.height;
            tempCtx.drawImage(image, 0, 0);
            return tempCtx.getImageData(0, 0, image.width, image.height);
        }

        function removeColor() {
            const targetColor = hexToRgb(selectedColor);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                if (isMatchingColor(data[i], data[i+1], data[i+2], targetColor)) {
                    data[i + 3] = 0; // Set alpha to 0 (transparent)
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }

        function hexToRgb(hex) {
            let bigint = parseInt(hex.slice(1), 16);
            return {
                r: (bigint >> 16) & 255,
                g: (bigint >> 8) & 255,
                b: bigint & 255
            };
        }

        function rgbToHex(r, g, b) {
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase()}`;
        }

        function isMatchingColor(r, g, b, targetColor, tolerance = 50) {
            return Math.abs(r - targetColor.r) < tolerance &&
                   Math.abs(g - targetColor.g) < tolerance &&
                   Math.abs(b - targetColor.b) < tolerance;
        }

        function downloadImage() {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = img.width;
            tempCanvas.height = img.height;
            tempCtx.putImageData(originalImgData, 0, 0);
            const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
            const data = imageData.data;

            const targetColor = hexToRgb(selectedColor);
            for (let i = 0; i < data.length; i += 4) {
                if (isMatchingColor(data[i], data[i + 1], data[i + 2], targetColor)) {
                    data[i + 3] = 0;
                }
            }
            tempCtx.putImageData(imageData, 0, 0);

            const link = document.createElement('a');
            link.href = tempCanvas.toDataURL('image/png');
            link.download = `${originalImageName}_FYNRESH.png`; // Append "_FYNRESH" to the original name
            link.click();
        }

        eyeDropperBtn.addEventListener('click', () => {
            if ('EyeDropper' in window) {
                const eyeDropper = new EyeDropper();
                eyeDropper.open().then(result => {
                    selectedColor = result.sRGBHex; // Set the selected color from eye dropper
                    updateColorFields(selectedColor);
                }).catch(e => {
                    alert('Color picking failed: ' + e);
                });
            } else {
                alert('Your browser does not support the EyeDropper API.');
            }
        });

        hexInput.addEventListener('input', () => {
            const hexValue = hexInput.value.trim();
            if (/^#[0-9A-Fa-f]{6}$/.test(hexValue)) {
                selectedColor = hexValue;
                updateColorFields(selectedColor);
            }
        });

        rgbInput.addEventListener('input', () => {
            const rgbValue = rgbInput.value.trim();
            const rgbMatch = rgbValue.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
            if (rgbMatch) {
                const r = parseInt(rgbMatch[1], 10);
                const g = parseInt(rgbMatch[2], 10);
                const b = parseInt(rgbMatch[3], 10);
                selectedColor = rgbToHex(r, g, b);
                updateColorFields(selectedColor);
            }
        });

        function updateColorFields(color) {
            selectedColorDiv.style.backgroundColor = color; // Show the selected color
            hexInput.value = color; // Update the hex input field
            rgbInput.value = hexToRgbString(color); // Update the RGB input field
        }

        function hexToRgbString(hex) {
            const rgb = hexToRgb(hex);
            return `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
        }
    </script>
</body>
</html>
