<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove Specific Color from Image</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        #canvas {
            max-width: 100%;
            max-height: 500.1px;
            border: 1px solid black;
            cursor: crosshair;
            margin-bottom: 20px;
        }
        #selectedColor {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 1px solid #000;
            display: inline-block;
            margin: 10px 0;
        }
        .color-inputs {
            margin: 10px 0;
        }
        .slider-container {
            margin: 10px 0;
        }
        .slider-label {
            margin-right: 10px;
            font-size: 14px;
        }
        #imageDimensions {
            margin: 10px 0;
            font-size: 14px;
        }
        #colorPickerContainer {
            display: inline-block;
            margin: 10px 0;
        }
        #fallbackColorPicker {
            display: none;
        }
        .preset-colors {
            display: flex;
            margin: 10px 0;
        }
        .preset-color {
            width: 30px;
            height: 30px;
            border: 1px solid #000;
            margin-right: 5px;
            cursor: pointer;
        }
        #meaning {
            font-size: 14px;
            margin-top: 10px;
            color: #555;
        }
        .eyeDropper-message {
            font-size: 14px;
            margin-top: 5px;
            color: #888;
        }
    </style>
</head>
<body>
    <input type="file" id="upload" accept="image/*">
    <div id="colorPickerContainer">
        <button id="eyeDropperBtn">ðŸ–¤ Pick Color (Desktop/Laptop)</button>
        <span class="eyeDropper-message">Works on Desktop/Laptop only</span>
    </div>
    <input type="color" id="fallbackColorPicker" title="Pick Color (Mobile)">
    <div class="color-inputs">
        <label for="hexInput">Hex Code:</label>
        <input type="text" id="hexInput" value="#ffffff">
    </div>
    <div class="color-inputs">
        <label for="rgbInput">RGB:</label>
        <input type="text" id="rgbInput" value="rgb(255, 255, 255)">
    </div>

    <!-- Sliders for RGB adjustment -->
    <div class="slider-container">
        <label class="slider-label" for="rSlider">R:</label>
        <input type="range" id="rSlider" min="0" max="255" value="255">
        <span id="rValue">255</span>
    </div>
    <div class="slider-container">
        <label class="slider-label" for="gSlider">G:</label>
        <input type="range" id="gSlider" min="0" max="255" value="255">
        <span id="gValue">255</span>
    </div>
    <div class="slider-container">
        <label class="slider-label" for="bSlider">B:</label>
        <input type="range" id="bSlider" min="0" max="255" value="255">
        <span id="bValue">255</span>
    </div>

    <!-- HSL sliders -->
    <div class="slider-container">
        <label class="slider-label" for="hSlider">H:</label>
        <input type="range" id="hSlider" min="0" max="360" value="0">
        <span id="hValue">0</span>
    </div>
    <div class="slider-container">
        <label class="slider-label" for="sSlider">S:</label>
        <input type="range" id="sSlider" min="0" max="100" value="100">
        <span id="sValue">100</span>
    </div>
    <div class="slider-container">
        <label class="slider-label" for="lSlider">L:</label>
        <input type="range" id="lSlider" min="0" max="100" value="100">
        <span id="lValue">100</span>
    </div>

    <div class="preset-colors">
        <div class="preset-color" style="background-color: #ff0000;" onclick="setColor('#ff0000')"></div>
        <div class="preset-color" style="background-color: #00ff00;" onclick="setColor('#00ff00')"></div>
        <div class="preset-color" style="background-color: #0000ff;" onclick="setColor('#0000ff')"></div>
        <div class="preset-color" style="background-color: #ffff00;" onclick="setColor('#ffff00')"></div>
        <div class="preset-color" style="background-color: #ff00ff;" onclick="setColor('#ff00ff')"></div>
    </div>

    <div id="selectedColor" style="background-color: #ffffff;"></div>
    <div id="imageDimensions">Dimensions: Not uploaded yet</div>
    <button onclick="removeColor()">Remove Color</button>
    <button onclick="downloadImage()">Download Image</button>
    <canvas id="canvas"></canvas>
    <div id="meaning">Select a color from the image or use the color picker to remove it from the image.</div>
    
    <script>
        const upload = document.getElementById('upload');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const eyeDropperBtn = document.getElementById('eyeDropperBtn');
        const fallbackColorPicker = document.getElementById('fallbackColorPicker');
        const hexInput = document.getElementById('hexInput');
        const rgbInput = document.getElementById('rgbInput');
        const selectedColorDiv = document.getElementById('selectedColor');
        const imageDimensions = document.getElementById('imageDimensions');
        const rSlider = document.getElementById('rSlider');
        const gSlider = document.getElementById('gSlider');
        const bSlider = document.getElementById('bSlider');
        const hSlider = document.getElementById('hSlider');
        const sSlider = document.getElementById('sSlider');
        const lSlider = document.getElementById('lSlider');
        const rValue = document.getElementById('rValue');
        const gValue = document.getElementById('gValue');
        const bValue = document.getElementById('bValue');
        const hValue = document.getElementById('hValue');
        const sValue = document.getElementById('sValue');
        const lValue = document.getElementById('lValue');
        const meaningText = document.getElementById('meaning');
        
        let img = new Image();
        let selectedColor = '#ffffff';
        let originalImgData;
        let originalImageSrc;
        let originalImageName = "image"; // Default name for the image

        upload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                originalImageName = file.name.split('.')[0]; // Extract name without extension
                const reader = new FileReader();
                reader.onload = (e) => {
                    img.src = e.target.result;
                    originalImageSrc = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        img.onload = () => {
            // Display image dimensions
            const width = img.width;
            const height = img.height;
            imageDimensions.textContent = `Dimensions: ${width}px x ${height}px`;

            // Store original image data in full quality
            originalImgData = getImageDataForOriginal(img);

            const maxSize = 500;
            let widthAdjusted = img.width;
            let heightAdjusted = img.height;
            if (widthAdjusted > maxSize || heightAdjusted > maxSize) {
                const ratio = Math.min(maxSize / widthAdjusted, maxSize / heightAdjusted);
                widthAdjusted = widthAdjusted * ratio;
                heightAdjusted = heightAdjusted * ratio;
            }

            canvas.width = widthAdjusted;
            canvas.height = heightAdjusted;
            ctx.drawImage(img, 0, 0, widthAdjusted, heightAdjusted);
        };

        function getImageDataForOriginal(image) {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = image.width;
            tempCanvas.height = image.height;
            tempCtx.drawImage(image, 0, 0);
            return tempCtx.getImageData(0, 0, image.width, image.height);
        }

        function removeColor() {
            const targetColor = hexToRgb(selectedColor);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                if (isMatchingColor(data[i], data[i+1], data[i+2], targetColor)) {
                    data[i + 3] = 0; // Set alpha to 0 (transparent)
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }

        function hexToRgb(hex) {
            let bigint = parseInt(hex.slice(1), 16);
            return {
                r: (bigint >> 16) & 255,
                g: (bigint >> 8) & 255,
                b: bigint & 255
            };
        }

        function rgbToHex(r, g, b) {
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase()}`;
        }

        function isMatchingColor(r, g, b, targetColor, tolerance = 50) {
            return Math.abs(r - targetColor.r) < tolerance &&
                   Math.abs(g - targetColor.g) < tolerance &&
                   Math.abs(b - targetColor.b) < tolerance;
        }

        function downloadImage() {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = img.width;
            tempCanvas.height = img.height;
            tempCtx.putImageData(originalImgData, 0, 0);
            const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
            const data = imageData.data;

            const targetColor = hexToRgb(selectedColor);
            for (let i = 0; i < data.length; i += 4) {
                if (isMatchingColor(data[i], data[i + 1], data[i + 2], targetColor)) {
                    data[i + 3] = 0;
                }
            }
            tempCtx.putImageData(imageData, 0, 0);

            const link = document.createElement('a');
            link.href = tempCanvas.toDataURL('image/png');
            link.download = `${originalImageName}_FYNRESH.png`; // Append "_FYNRESH" to the original name
            link.click();
        }

        // Handle RGB sliders and updates
        function updateColorFromSliders() {
            const r = rSlider.value;
            const g = gSlider.value;
            const b = bSlider.value;
            selectedColor = rgbToHex(r, g, b);
            updateColorFields(selectedColor);
        }

        rSlider.addEventListener('input', updateColorFromSliders);
        gSlider.addEventListener('input', updateColorFromSliders);
        bSlider.addEventListener('input', updateColorFromSliders);

        // Handle HSL sliders and updates
        function updateColorFromHsl() {
            const h = hSlider.value;
            const s = sSlider.value / 100;
            const l = lSlider.value / 100;
            const rgb = hslToRgb(h, s, l);
            selectedColor = rgbToHex(rgb.r, rgb.g, rgb.b);
            updateColorFields(selectedColor);
        }

        hSlider.addEventListener('input', updateColorFromHsl);
        sSlider.addEventListener('input', updateColorFromHsl);
        lSlider.addEventListener('input', updateColorFromHsl);

        function hslToRgb(h, s, l) {
            s /= 100;
            l /= 100;
            const c = (1 - Math.abs(2 * l - 1)) * s;
            const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
            const m = l - c / 2;

            let r = 0, g = 0, b = 0;

            if (h >= 0 && h < 60) {
                r = c;
                g = x;
                b = 0;
            } else if (h >= 60 && h < 120) {
                r = x;
                g = c;
                b = 0;
            } else if (h >= 120 && h < 180) {
                r = 0;
                g = c;
                b = x;
            } else if (h >= 180 && h < 240) {
                r = 0;
                g = x;
                b = c;
            } else if (h >= 240 && h < 300) {
                r = x;
                g = 0;
                b = c;
            } else if (h >= 300 && h < 360) {
                r = c;
                g = 0;
                b = x;
            }

            r = Math.round((r + m) * 255);
            g = Math.round((g + m) * 255);
            b = Math.round((b + m) * 255);

            return { r, g, b };
        }

        function setColor(color) {
            selectedColor = color;
            updateColorFields(selectedColor);
        }

        function updateColorFields(color) {
            selectedColorDiv.style.backgroundColor = color; // Show the selected color
            hexInput.value = color; // Update the hex input field
            rgbInput.value = hexToRgbString(color); // Update the RGB input field
        }

        function hexToRgbString(hex) {
            const rgb = hexToRgb(hex);
            return `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
        }
    </script>
</body>
</html>
